<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†¡ì–‘ê³  ì˜¤ëŠ˜ì˜ ê¸‰ì‹</title>
    <style>
        body { margin: 0; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #ffffff; color: #37352f; }
        .container { max-width: 100%; }
        h3 { margin: 0 0 10px 0; font-size: 16px; color: #eb5757; font-weight: 600; }
        .menu { font-size: 14px; line-height: 1.6; white-space: pre-wrap; word-break: keep-all; }
        .info { font-size: 12px; color: #888; margin-top: 5px; }
        .error { color: #e03e3e; font-size: 13px; }
    </style>
</head>
<body>
    <div class="container">
        <h3>ğŸ± <span id="date-display">ì˜¤ëŠ˜</span>ì˜ ì ì‹¬</h3>
        
        <div id="meal-box" class="menu">
            <span class="info">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
        </div>
        <div id="kcal-box" class="info"></div>
    </div>

    <script>
        // â–¼â–¼â–¼ ì—¬ê¸°ì— ì¸ì¦í‚¤ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš” (ë”°ì˜´í‘œ ì•ˆì—) â–¼â–¼â–¼
        const API_KEY = 'eddddf6d86cc4953a00248d7496c0c8a'; 
        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        const EDU_CODE = 'J10'; // ê²½ê¸°ë„êµìœ¡ì²­
        const SCH_CODE = '7531123'; // ì†¡ì–‘ê³ ë“±í•™êµ
        
        // ì˜¤ëŠ˜ ë‚ ì§œ êµ¬í•˜ê¸°
        const today = new Date();
        const year = today.getFullYear();
        const month = ('0' + (today.getMonth() + 1)).slice(-2);
        const day = ('0' + today.getDate()).slice(-2);
        const dateStr = `${year}${month}${day}`; // YYYYMMDD
        
        // í™”ë©´ì— ë‚ ì§œ í‘œì‹œ (ì˜ˆ: 12ì›” 05ì¼)
        document.getElementById('date-display').innerText = `${month}ì›” ${day}ì¼`;

        // URL ìƒì„± (ì¤‘ì‹: Code=2, íƒ€ì…: json í•„ìˆ˜)
        const url = `https://open.neis.go.kr/hub/mealServiceDietInfo?Type=json&KEY=${API_KEY}&ATPT_OFCDC_SC_CODE=${EDU_CODE}&SD_SCHUL_CODE=${SCH_CODE}&MMEAL_SC_CODE=2&MLSV_YMD=${dateStr}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const mealBox = document.getElementById('meal-box');
                const kcalBox = document.getElementById('kcal-box');

                // 1. ì—ëŸ¬ ì²´í¬ (í‚¤ê°€ í‹€ë¦¬ê±°ë‚˜ ë“±ë“±)
                if (data.RESULT && data.RESULT.CODE !== 'INFO-000') {
                    if(data.RESULT.CODE === 'INFO-200') {
                        mealBox.innerText = "ì˜¤ëŠ˜ì€ ê¸‰ì‹ì´ ì—†ìŠµë‹ˆë‹¤."; // ì£¼ë§/ê³µíœ´ì¼
                    } else {
                        mealBox.innerText = `ì˜¤ë¥˜ ë°œìƒ: ${data.RESULT.MESSAGE}`; // í‚¤ ì˜¤ë¥˜ ë“±
                        mealBox.className = 'error';
                    }
                    return;
                }

                // 2. ì •ìƒ ë°ì´í„° ì²˜ë¦¬
                if (data.mealServiceDietInfo) {
                    const row = data.mealServiceDietInfo[1].row[0];
                    const rawMenu = row.DDISH_NM;
                    const rawKcal = row.CAL_INFO;

                    // ë©”ë‰´ ì •ë¦¬ (ì§€ì €ë¶„í•œ ìˆ«ì, ê´„í˜¸ ì œê±°)
                    const cleanMenu = rawMenu.replace(/\([0-9\.]+\)/g, '').replace(/<br\/>/g, '\n');
                    
                    mealBox.innerText = cleanMenu;
                    kcalBox.innerText = `ì—´ëŸ‰: ${rawKcal}`;
                } else {
                    mealBox.innerText = "ê¸‰ì‹ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                }
            })
            .catch(error => {
                console.error(error);
                document.getElementById('meal-box').innerText = "ë„¤íŠ¸ì›Œí¬/ì„œë²„ ì—°ê²° ì‹¤íŒ¨";
            });
    </script>
</body>
</html>
