<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†¡ì–‘ê³  ì˜¤ëŠ˜ ì ì‹¬</title>
    <style>
        /* ë…¸ì…˜ ì„ë² ë“œì— ìµœì í™”ëœ ì‹¬í”Œ ë””ìì¸ */
        body { 
            margin: 0; 
            padding: 20px; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            background-color: #ffffff; 
            color: #37352f; 
        }
        h3 { 
            margin: 0 0 10px 0; 
            font-size: 16px; 
            color: #eb5757; /* ë¶‰ì€ìƒ‰ í¬ì¸íŠ¸ */
            font-weight: 600; 
        }
        .menu { 
            font-size: 14px; 
            line-height: 1.6; 
            white-space: pre-wrap; 
            word-break: keep-all; 
        }
        
        /* ì •ë³´ í…ìŠ¤íŠ¸ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .info-text { 
            margin-top: 6px; 
            font-size: 12px; 
            color: #888; 
            line-height: 1.5;
            white-space: pre-wrap; 
        }
        
        /* [ìˆ˜ì •ë¨] ì˜ì–‘ ì •ë³´ ìŠ¤íƒ€ì¼: êµ¬ë¶„ì„  ì œê±° ë° ì—¬ë°± ìµœì†Œí™” */
        .nutri-box {
            margin-top: 0;   /* ìœ„ìª½ ì—¬ë°± ì œê±° (ì—´ëŸ‰ ë°”ë¡œ ë°‘ì— ë¶™ìŒ) */
            padding-top: 0;  /* ì•ˆìª½ ì—¬ë°± ì œê±° */
            border-top: none; /* êµ¬ë¶„ì„  ì œê±° */
        }

        .error { color: #e03e3e; font-size: 13px; }
    </style>
</head>
<body>
    <div id="container">
        <h3>ğŸ± <span id="date-display">ì˜¤ëŠ˜</span>ì˜ ì ì‹¬</h3>
        
        <div id="meal-box" class="menu">ë©”ë‰´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        
        <div id="kcal-box" class="info-text"></div>

        <div id="nutri-box" class="info-text nutri-box"></div>
    </div>

    <script>
        // â–¼â–¼â–¼ ì„ ìƒë‹˜ì´ ë³´ë‚´ì£¼ì‹  ì¸ì¦í‚¤ë¥¼ ì ìš©í–ˆìŠµë‹ˆë‹¤ â–¼â–¼â–¼
        const API_KEY = 'eddddf6d86cc4953a00248d7496c0c8a'; 
        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        const EDU_CODE = 'J10'; // ê²½ê¸°ë„êµìœ¡ì²­
        const SCH_CODE = '7531167'; // ì†¡ì–‘ê³ ë“±í•™êµ
        
        // ë‚ ì§œ ë° ìš”ì¼ ê³„ì‚°
        const now = new Date();
        const year = now.getFullYear();
        const month = ('0' + (now.getMonth() + 1)).slice(-2);
        const day = ('0' + now.getDate()).slice(-2);
        const dateStr = `${year}${month}${day}`;

        const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        const dayOfWeek = days[now.getDay()];
        
        // í™”ë©´ ë‚ ì§œ í‘œì‹œ
        document.getElementById('date-display').innerText = `${now.getMonth() + 1}ì›” ${now.getDate()}ì¼(${dayOfWeek})`;

        // API ì£¼ì†Œ ìƒì„± (ì¤‘ì‹ ì½”ë“œ: 2)
        const url = `https://open.neis.go.kr/hub/mealServiceDietInfo?Type=json&KEY=${API_KEY}&ATPT_OFCDC_SC_CODE=${EDU_CODE}&SD_SCHUL_CODE=${SCH_CODE}&MLSV_YMD=${dateStr}&MMEAL_SC_CODE=2`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const mealBox = document.getElementById('meal-box');
                const nutriBox = document.getElementById('nutri-box');

                if (data.mealServiceDietInfo) {
                    const row = data.mealServiceDietInfo[1].row[0];
                    let menu = row.DDISH_NM;
                    
                    // 1. ì˜ì–‘ ì •ë³´ í•„í„°ë§
                    const rawNutri = row.NTR_INFO; 
                    const targets = ['íƒ„ìˆ˜í™”ë¬¼', 'ë‹¨ë°±ì§ˆ', 'ì§€ë°©']; 
                    
                    const filteredNutri = rawNutri.split('<br/>').filter(line => {
                        return targets.some(target => line.includes(target));
                    }).join('\n');

                    // 2. í…ìŠ¤íŠ¸ ì •ë¦¬
                    menu = menu.replace(/\([0-9\.]+\)/g, '').replace(/<br\/>/g, '\n');
                    
                    // 3. í™”ë©´ ì¶œë ¥
                    mealBox.innerText = menu;
                    document.getElementById('kcal-box').innerText = `ì—´ëŸ‰: ${row.CAL_INFO}`;
                    nutriBox.innerText = filteredNutri; // êµ¬ë¶„ì„  ì—†ì´ ë°”ë¡œ ì¶œë ¥ë¨

                } else {
                    mealBox.innerText = "ì˜¤ëŠ˜ì€ ê¸‰ì‹ì´ ì—†ìŠµë‹ˆë‹¤.";
                }
            })
            .catch(err => {
                console.error(err);
                document.getElementById('meal-box').innerText = "ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            });
    </script>
</body>
</html>
